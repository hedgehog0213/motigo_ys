<!DOCTYPE html>
<html lang="ko">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Motigo_Join</title>
</head>
<body>
<!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script>
	// TODO: Replace the following with your app's Firebase project configuration
	// For Firebase JavaScript SDK v7.20.0 and later, `measurementId` is an optional field
	var firebaseConfig = {
    apiKey: "AIzaSyCDdRnBH7OF25AIZZtMN4gXyJNxSHlBWWs",
    authDomain: "yskim-solo.firebaseapp.com",
    databaseURL: "https://yskim-solo-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "yskim-solo",
    storageBucket: "yskim-solo.appspot.com",
    messagingSenderId: "391332700991",
    appId: "1:391332700991:web:57e0192716fd2d50ee298a"
  };

	// Initialize Firebase
	firebase.initializeApp(firebaseConfig);

        var provider = new firebase.auth.GoogleAuthProvider();

	function authpop() {
		firebase.auth().signInWithPopup(provider).then(function(result) {
			var token = result.credential.accessToken;
			var user = result.user;
            var uid = firebase.auth().currentUser.uid
            var username = firebase.auth().currentUser.displayName
            var email = firebase.auth().currentUser.email
            var createdate = firebase.auth().currentUser.metadata.creationTime


            info = []
            info.push(uid)
            info.push(username)
            info.push(email)
            info.push(createdate)

            const user_profile = {info}
            const j = JSON.stringify(user_profile);
            console.log('제이슨화된 객체', j)

            $.ajax({
            url:"/saveSQL",
            type:"POST",
            contentType: "application/json",
            data: JSON.stringify(j),
            success:function(data){
              alert(username+"님 환영합니다");
              window.location.href = "/trans";
          }
          });


		}).catch(function(error) {
			alertmsg = 'errorCode: ' + error.code + '\r\n';
			alertmsg += 'errorMessage: ' + error.message + '\r\n';
			alertmsg += 'email: ' + error.email + '\r\n';
			alertmsg += 'credential: ' + error.credential + '\r\n';
			alert(alertmsg);
			console.log(alertmsg);
		});
	}
</script>

<button type="button" onclick="authpop()">구글 계정으로 로그인하기</button>
<button type="button" onclick="authsignout()">sign out</button>


</body>

</html>